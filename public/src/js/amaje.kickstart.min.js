/*
 * Slim v1.1.1 - Image Cropping Made Easy
 * Copyright (c) 2016 Rik Schennink - http://amaje.pqina.nl
 */
!function(t,e){function i(){t.Slim.parse(document)}t&&t.addEventListener&&(t.Slim=function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){return Array.prototype.slice.call(t.attributes).map(function(t){return{name:t.name,value:t.value}})}function n(t){return{x:"undefined"==typeof t.offsetX?t.layerX:t.offsetX,y:"undefined"==typeof t.offsetY?t.layerY:t.offsetY}}function o(t,e){var i,n={},o=e||{};for(i in t)t.hasOwnProperty(i)&&(n[i]="undefined"==typeof o[i]?t[i]:o[i]);return n}function r(t,e){var i=document.createElement(t);return e&&(i.className=e),i}function a(t,e,i){e.forEach(function(e){t.addEventListener(e,i,!1)})}function s(t,e,i){e.forEach(function(e){t.removeEventListener(e,i,!1)})}function h(t){var e=t.changedTouches?t.changedTouches[0]:t;if(e)return{x:e.pageX,y:e.pageY}}function u(t,e){var i=h(t),n=e.getBoundingClientRect(),o=window.pageYOffset||document.documentElement.scrollTop,r=window.pageXOffset||document.documentElement.scrollLeft;return{x:i.x-n.left-r,y:i.y-n.top-o}}function l(t){return t.charAt(0).toUpperCase()+t.slice(1)}function c(t){return t[t.length-1]}function p(t,e,i){return Math.max(e,Math.min(i,t))}function d(t,e){return-1!==e.indexOf(t)}function f(t,e,i,n,o){var r=new XMLHttpRequest;i&&r.upload.addEventListener("progress",function(t){i(t.loaded,t.total)}),r.open("POST",t,!0),r.onreadystatechange=function(){if(4===r.readyState&&200===r.status){var t=r.responseText;if(!t.length)return void n();if(-1!==t.indexOf("Content-Length"))return void o("file-too-big");var e=null;try{e=JSON.parse(r.responseText)}catch(i){}n(e||t)}else 4===r.readyState&&o("fail")},r.send(e)}function m(t){t.style.transform=""}function g(t){return t/1e6}function _(){var t=[],i=e,n=e;for(i in ot)n=ot[i],-1==t.indexOf(n)&&t.push(n);return t}function v(t){var i=e;for(i in ot)if(ot[i]===t)return i;return t}function y(t){return ot[t]||"unknown"}function w(t){return"string"==typeof t?/^data:image/.test(t)?{name:"unknown",type:F(t),size:null}:{name:t.split("/").pop(),type:y(t.split(".").pop()),size:null}:{name:t.name,type:t.type,size:t.size}}function b(t,e){J.parseMetaData(t,function(i){var n={canvas:!0,crossOrigin:!0};i.exif&&(n.orientation=i.exif.get("Orientation")),J(t,function(t){return"error"===t.type?void e():void e(t,i)},n)})}function k(t,e,i){var n,o,r,a,s=e/t;return i>s?(a=e,r=a/i,n=.5*(t-r),o=0):(r=t,a=r*i,n=0,o=.5*(e-a)),{x:n,y:o,height:a,width:r}}function x(t,i,n){i===e&&(i={});var o=r("canvas"),a={width:t.width,height:t.height},s=i.crop,h=i.size;if(s){o.width=s.width,o.height=s.height,s=L(s),s.y+s.height>a.height&&(s.y=Math.max(0,a.height-s.height)),s.x+s.width>a.width&&(s.x=Math.max(0,a.width-s.width));var u=o.getContext("2d");u.drawImage(t,s.x,s.y,s.width,s.height,0,0,s.width,s.height)}h&&E(o,Math.min(h.width/o.width,h.height/o.height)),n(o)}function E(t,e){if(!(e>=1)){for(var i,n=C(t),o=t.width,a=t.height,s=Math.ceil(t.width*e),h=Math.ceil(t.height*e);o>s&&(o*=.5,a*=.5,!(s>o));)n=r("canvas"),n.width=o,n.height=a,i=n.getContext("2d"),i.drawImage(t,0,0,o,a);t.width=s,t.height=h,i=t.getContext("2d"),i.drawImage(n,0,0,s,h)}}function C(t){return S(t,1)}function S(t,e){if(!t)return null;var i=document.createElement("canvas");i.setAttribute("data-file",t.getAttribute("data-file"));var n=i.getContext("2d");return i.width=t.width,i.height=t.height,n.drawImage(t,0,0),e>0&&1!=e&&E(i,e),i}function P(t){return t.width&&t.height}function O(t,e){var i=e.getContext("2d");P(e)?i.drawImage(t,0,0,e.width,e.height):(e.width=t.width,e.height=t.height,i.drawImage(t,0,0))}function I(t){var e=t.getContext("2d");e.clearRect(0,0,t.width,t.height)}function M(t){tt(t,0,0,t.width,t.height,3)}function T(t,e){return{x:t.x*e,y:t.y*e,width:t.width*e,height:t.height*e}}function L(t){return{x:Math.floor(t.x),y:Math.floor(t.y),width:Math.floor(t.width),height:Math.floor(t.height)}}function D(t){if(t&&""!==t.value){try{t.value=""}catch(e){}if(t.value){var i=document.createElement("form"),n=t.parentNode,o=t.nextSibling;i.appendChild(t),i.reset(),o?n.insertBefore(t,o):n.appendChild(t)}}}function p(t,e,i){return Math.min(Math.max(t,e),i)}function A(t){return t?JSON.parse(JSON.stringify(t)):t}function R(t){var e=C(t.input.image),i=C(t.output.image),n=A(t);return n.input.image=e,n.output.image=i,n}function F(t){if(!t)return null;var e=t.match(/^.+;/);return e.length?e[0].substring(5,e[0].length-1):null}function z(t){var i=arguments.length<=1||arguments[1]===e?[]:arguments[1],n=null,o={server:A(t.server),meta:A(t.meta),input:{name:t.input.name,type:t.input.type,size:t.input.size,width:t.input.width,height:t.input.height},output:{width:t.output.width,height:t.output.height}};if(d("input",i)&&(o.input.image=t.input.image.toDataURL(t.input.type,1)),d("output",i)&&(o.output.image=t.output.image.toDataURL(t.input.type,1)),d("actions",i)&&(o.actions=A(t.actions)),n=F(o.output.image||o.input.image),"image/png"===n){var r=o.input.name;o.input.name=r.substr(0,r.lastIndexOf("."))+".png",o.input.type=n}return o}function U(t,e,i){var n=i.querySelector(t);n&&(n.style.display=e?"":"none")}function N(t){return Array.prototype.slice.call(t)}function H(t){t.parentNode.removeChild(t)}function B(t){var e=r("div");return t.parentNode&&(t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)),e.appendChild(t),e}function W(t,e,i,n){var o=(n-90)*Math.PI/180;return{x:t+i*Math.cos(o),y:e+i*Math.sin(o)}}function q(t,e,i,n,o){var r=W(t,e,i,o),a=W(t,e,i,n),s=180>=o-n?"0":"1",h=["M",r.x,r.y,"A",i,i,0,s,0,a.x,a.y].join(" ");return h}function j(t,e,i,n){return q(t,e,i,0,360*n)}function V(t,e){return t.split(e).map(function(t){return parseInt(t,10)})}function G(t){return"DIV"==t.nodeName}var J=function(t,e,i){var n,o,r=document.createElement("img");if(r.onerror=e,r.onload=function(){!o||i&&i.noRevoke||J.revokeObjectURL(o),e&&e(J.scale(r,i))},J.isInstanceOf("Blob",t)||J.isInstanceOf("File",t))n=o=J.createObjectURL(t),r._type=t.type;else{if("string"!=typeof t)return!1;n=t,i&&i.crossOrigin&&(r.crossOrigin=i.crossOrigin)}return n?(r.src=n,r):J.readFile(t,function(t){var i=t.target;i&&i.result?r.src=i.result:e&&e(t)})},X=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;J.isInstanceOf=function(t,e){return Object.prototype.toString.call(e)==="[object "+t+"]"},J.transformCoordinates=function(){},J.getTransformedOptions=function(t,e){var i,n,o,r,a=e.aspectRatio;if(!a)return e;i={};for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return i.crop=!0,o=t.naturalWidth||t.width,r=t.naturalHeight||t.height,o/r>a?(i.maxWidth=r*a,i.maxHeight=r):(i.maxWidth=o,i.maxHeight=o/a),i},J.renderImageToCanvas=function(t,e,i,n,o,r,a,s,h,u){return t.getContext("2d").drawImage(e,i,n,o,r,a,s,h,u),t},J.hasCanvasOption=function(t){return t.canvas||t.crop||!!t.aspectRatio},J.scale=function(t,i){function n(){var t=Math.max((s||w)/w,(h||b)/b);t>1&&(w*=t,b*=t)}function o(){var t=Math.min((r||w)/w,(a||b)/b);1>t&&(w*=t,b*=t)}i=i||{};var r,a,s,h,u,l,c,p,d,f,m,g=document.createElement("canvas"),_=t.getContext||J.hasCanvasOption(i)&&g.getContext,v=t.naturalWidth||t.width,y=t.naturalHeight||t.height,w=v,b=y;if(_&&(i=J.getTransformedOptions(t,i),c=i.left||0,p=i.top||0,i.sourceWidth?(u=i.sourceWidth,i.right!==e&&i.left===e&&(c=v-u-i.right)):u=v-c-(i.right||0),i.sourceHeight?(l=i.sourceHeight,i.bottom!==e&&i.top===e&&(p=y-l-i.bottom)):l=y-p-(i.bottom||0),w=u,b=l),r=i.maxWidth,a=i.maxHeight,s=i.minWidth,h=i.minHeight,_&&r&&a&&i.crop?(w=r,b=a,m=u/l-r/a,0>m?(l=a*u/r,i.top===e&&i.bottom===e&&(p=(y-l)/2)):m>0&&(u=r*l/a,i.left===e&&i.right===e&&(c=(v-u)/2))):((i.contain||i.cover)&&(s=r=r||s,h=a=a||h),i.cover?(o(),n()):(n(),o())),_){if(d=i.pixelRatio,d>1&&(g.style.width=w+"px",g.style.height=b+"px",w*=d,b*=d,g.getContext("2d").scale(d,d)),f=i.downsamplingRatio,f>0&&1>f&&u>w&&l>b)for(;u*f>w;)g.width=u*f,g.height=l*f,J.renderImageToCanvas(g,t,c,p,u,l,0,0,g.width,g.height),u=g.width,l=g.height,t=document.createElement("canvas"),t.width=u,t.height=l,J.renderImageToCanvas(t,g,0,0,u,l,0,0,u,l);return g.width=w,g.height=b,J.transformCoordinates(g,i),J.renderImageToCanvas(g,t,c,p,u,l,0,0,w,b)}return t.width=w,t.height=b,t},J.createObjectURL=function(t){return X?X.createObjectURL(t):!1},J.revokeObjectURL=function(t){return X?X.revokeObjectURL(t):!1},J.readFile=function(t,e,i){if(window.FileReader){var n=new FileReader;if(n.onload=n.onerror=e,i=i||"readAsDataURL",n[i])return n[i](t),n}return!1};var Y=J.hasCanvasOption,$=J.transformCoordinates,Z=J.getTransformedOptions;J.hasCanvasOption=function(t){return!!t.orientation||Y.call(J,t)},J.transformCoordinates=function(t,e){$.call(J,t,e);var i=t.getContext("2d"),n=t.width,o=t.height,r=t.style.width,a=t.style.height,s=e.orientation;if(s&&!(s>8))switch(s>4&&(t.width=o,t.height=n,t.style.width=a,t.style.height=r),s){case 2:i.translate(n,0),i.scale(-1,1);break;case 3:i.translate(n,o),i.rotate(Math.PI);break;case 4:i.translate(0,o),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-o);break;case 7:i.rotate(.5*Math.PI),i.translate(n,-o),i.scale(-1,1);break;case 8:i.rotate(-.5*Math.PI),i.translate(-n,0)}},J.getTransformedOptions=function(t,e){var i,n,o=Z.call(J,t,e),r=o.orientation;if(!r||r>8||1===r)return o;i={};for(n in o)o.hasOwnProperty(n)&&(i[n]=o[n]);switch(o.orientation){case 2:i.left=o.right,i.right=o.left;break;case 3:i.left=o.right,i.top=o.bottom,i.right=o.left,i.bottom=o.top;break;case 4:i.top=o.bottom,i.bottom=o.top;break;case 5:i.left=o.top,i.top=o.left,i.right=o.bottom,i.bottom=o.right;break;case 6:i.left=o.top,i.top=o.right,i.right=o.bottom,i.bottom=o.left;break;case 7:i.left=o.bottom,i.top=o.right,i.right=o.top,i.bottom=o.left;break;case 8:i.left=o.bottom,i.top=o.left,i.right=o.top,i.bottom=o.right}return o.orientation>4&&(i.maxWidth=o.maxHeight,i.maxHeight=o.maxWidth,i.minWidth=o.minHeight,i.minHeight=o.minWidth,i.sourceWidth=o.sourceHeight,i.sourceHeight=o.sourceWidth),i};var K=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);J.blobSlice=K&&function(){var t=this.slice||this.webkitSlice||this.mozSlice;return t.apply(this,arguments)},J.metaDataParsers={jpeg:{65505:[]}},J.parseMetaData=function(t,e,i){i=i||{};var n=this,o=i.maxMetaDataSize||262144,r={},a=!(window.DataView&&t&&t.size>=12&&"image/jpeg"===t.type&&J.blobSlice);!a&&J.readFile(J.blobSlice.call(t,0,o),function(t){if(t.target.error)return console.log(t.target.error),void e(r);var o,a,s,h,u=t.target.result,l=new DataView(u),c=2,p=l.byteLength-4,d=c;if(65496===l.getUint16(0)){for(;p>c&&(o=l.getUint16(c),o>=65504&&65519>=o||65534===o);){if(a=l.getUint16(c+2)+2,c+a>l.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(s=J.metaDataParsers.jpeg[o])for(h=0;h<s.length;h+=1)s[h].call(n,l,c,a,r,i);c+=a,d=c}!i.disableImageHead&&d>6&&(u.slice?r.imageHead=u.slice(0,d):r.imageHead=new Uint8Array(u).subarray(0,d))}else console.log("Invalid JPEG file: Missing JPEG marker.");e(r)},"readAsArrayBuffer")||e(r)},J.ExifMap=function(){return this},J.ExifMap.prototype.map={Orientation:274},J.ExifMap.prototype.get=function(t){return this[t]||this[this.map[t]]},J.getExifThumbnail=function(t,e,i){var n,o,r;if(!i||e+i>t.byteLength)return void console.log("Invalid Exif data: Invalid thumbnail data.");for(n=[],o=0;i>o;o+=1)r=t.getUint8(e+o),n.push((16>r?"0":"")+r.toString(16));return"data:image/jpeg,%"+n.join("%")},J.exifTagTypes={1:{getValue:function(t,e){return t.getUint8(e)},size:1},2:{getValue:function(t,e){return String.fromCharCode(t.getUint8(e))},size:1,ascii:!0},3:{getValue:function(t,e,i){return t.getUint16(e,i)},size:2},4:{getValue:function(t,e,i){return t.getUint32(e,i)},size:4},5:{getValue:function(t,e,i){return t.getUint32(e,i)/t.getUint32(e+4,i)},size:8},9:{getValue:function(t,e,i){return t.getInt32(e,i)},size:4},10:{getValue:function(t,e,i){return t.getInt32(e,i)/t.getInt32(e+4,i)},size:8}},J.exifTagTypes[7]=J.exifTagTypes[1],J.getExifValue=function(t,e,i,n,o,r){var a,s,h,u,l,c,p=J.exifTagTypes[n];if(!p)return void console.log("Invalid Exif data: Invalid tag type.");if(a=p.size*o,s=a>4?e+t.getUint32(i+8,r):i+8,s+a>t.byteLength)return void console.log("Invalid Exif data: Invalid data offset.");if(1===o)return p.getValue(t,s,r);for(h=[],u=0;o>u;u+=1)h[u]=p.getValue(t,s+u*p.size,r);if(p.ascii){for(l="",u=0;u<h.length&&(c=h[u],"\x00"!==c);u+=1)l+=c;return l}return h},J.parseExifTag=function(t,e,i,n,o){var r=t.getUint16(i,n);o.exif[r]=J.getExifValue(t,e,i,t.getUint16(i+2,n),t.getUint32(i+4,n),n)},J.parseExifTags=function(t,e,i,n,o){var r,a,s;if(i+6>t.byteLength)return void console.log("Invalid Exif data: Invalid directory offset.");if(r=t.getUint16(i,n),a=i+2+12*r,a+4>t.byteLength)return void console.log("Invalid Exif data: Invalid directory size.");for(s=0;r>s;s+=1)this.parseExifTag(t,e,i+2+12*s,n,o);return t.getUint32(a,n)},J.parseExifData=function(t,e,i,n,o){if(!o.disableExif){var r,a,s,h=e+10;if(1165519206===t.getUint32(e+4)){if(h+8>t.byteLength)return void console.log("Invalid Exif data: Invalid segment size.");if(0!==t.getUint16(e+8))return void console.log("Invalid Exif data: Missing byte alignment offset.");switch(t.getUint16(h)){case 18761:r=!0;break;case 19789:r=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==t.getUint16(h+2,r))return void console.log("Invalid Exif data: Missing TIFF marker.");a=t.getUint32(h+4,r),n.exif=new J.ExifMap,a=J.parseExifTags(t,h,h+a,r,n),a&&!o.disableExifThumbnail&&(s={exif:{}},a=J.parseExifTags(t,h,h+a,r,s),s.exif[513]&&(n.exif.Thumbnail=J.getExifThumbnail(t,h+s.exif[513],s.exif[514]))),n.exif[34665]&&!o.disableExifSub&&J.parseExifTags(t,h,h+n.exif[34665],r,n),n.exif[34853]&&!o.disableExifGps&&J.parseExifTags(t,h,h+n.exif[34853],r,n)}}},J.metaDataParsers.jpeg[65505].push(J.parseExifData);var Q=function(){var t=[],i=[],n=[],o="transform",r=window.getComputedStyle(document.documentElement,""),a=(Array.prototype.slice.call(r).join("").match(/-(moz|webkit|ms)-/)||""===r.OLink&&["","o"])[1];"webkit"===a&&(o="webkitTransform");var s=function(t,i,n){var o=t;if(o.length!==e){for(var r={chainers:[],then:function(t){return this.snabbt(t)},snabbt:function(t){var e=this.chainers.length;return this.chainers.forEach(function(i,n){i.snabbt(h(t,n,e))}),r},setValue:function(t){return this.chainers.forEach(function(e){e.setValue(t)}),r},finish:function(){return this.chainers.forEach(function(t){t.finish()}),r},rollback:function(){return this.chainers.forEach(function(t){t.rollback()}),r}},a=0,s=o.length;s>a;++a)"string"==typeof i?r.chainers.push(u(o[a],i,h(n,a,s))):r.chainers.push(u(o[a],h(i,a,s),n));return r}return"string"==typeof i?u(o,i,h(n,0,1)):u(o,h(i,0,1),n)},h=function(t,e,i){if(!t)return t;var n=J(t);G(t.delay)&&(n.delay=t.delay(e,i)),G(t.callback)&&(n.complete=function(){t.callback.call(this,e,i)});var o=G(t.allDone),r=G(t.complete);(r||o)&&(n.complete=function(){r&&t.complete.call(this,e,i),o&&e==i-1&&t.allDone()}),G(t.valueFeeder)&&(n.valueFeeder=function(n,o){return t.valueFeeder(n,o,e,i)}),G(t.easing)&&(n.easing=function(n){return t.easing(n,e,i)});var a=["position","rotation","skew","rotationPost","scale","width","height","opacity","fromPosition","fromRotation","fromSkew","fromRotationPost","fromScale","fromWidth","fromHeight","fromOpacity","transformOrigin","duration","delay"];return a.forEach(function(o){G(t[o])&&(n[o]=t[o](e,i))}),n},u=function(t,e,n){function o(e){return f.tick(e),f.updateElement(t),f.isStopped()?void 0:f.completed()?void(r.loop>1&&!f.isStopped()?(r.loop-=1,f.restart(),y(o)):(r.complete&&r.complete.call(t),v.length&&(r=v.pop(),s=g(r,u,!0),u=g(r,J(u)),r=_(s,u,r),f=b(r),i.push([t,f]),f.tick(e),y(o)))):y(o)}if("attention"===e)return l(t,n);if("stop"===e)return c(t);var r=e;d();var a=m(t),s=a;s=g(r,s,!0);var u=J(a);u=g(r,u);var p=_(s,u,r),f=b(p);i.push([t,f]),f.updateElement(t,!0);var v=[],w={snabbt:function(t){return v.unshift(h(t,0,1)),w},then:function(t){return this.snabbt(t)}};return y(o),r.manual?f:w},l=function(t,e){function n(i){r.tick(i),r.updateElement(t),r.completed()?(e.callback&&e.callback(t),e.loop&&e.loop>1&&(e.loop--,r.restart(),y(n))):y(n)}var o=g(e,H({}));e.movement=o;var r=k(e);i.push([t,r]),y(n)},c=function(t){for(var e=0,n=i.length;n>e;++e){var o=i[e],r=o[0],a=o[1];r===t&&a.stop()}},p=function(t,e){for(var i=0,n=t.length;n>i;++i){var o=t[i],r=o[0],a=o[1];if(r===e){var s=a.getCurrentState();return a.stop(),s}}},d=function(){n=n.filter(function(t){return f(t[0]).body})},f=function(t){for(var e=t;e.parentNode;)e=e.parentNode;return e},m=function(t){var e=p(i,t);return e?e:p(n,t)},g=function(t,e,i){e||(e=H({position:[0,0,0],rotation:[0,0,0],rotationPost:[0,0,0],scale:[1,1],skew:[0,0]}));var n="position",o="rotation",r="skew",a="rotationPost",s="scale",h="scalePost",u="width",l="height",c="opacity";return i&&(n="fromPosition",o="fromRotation",r="fromSkew",a="fromRotationPost",s="fromScale",h="fromScalePost",u="fromWidth",l="fromHeight",c="fromOpacity"),e.position=q(t[n],e.position),e.rotation=q(t[o],e.rotation),e.rotationPost=q(t[a],e.rotationPost),e.skew=q(t[r],e.skew),e.scale=q(t[s],e.scale),e.scalePost=q(t[h],e.scalePost),e.opacity=t[c],e.width=t[u],e.height=t[l],e},_=function(t,e,i){return i.startState=t,i.endState=e,i},v=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},y=function(e){0===t.length&&v(w),t.push(e)},w=function(e){for(var o=t.length,r=0;o>r;++r)t[r](e);t.splice(0,o);var a=i.filter(function(t){return t[1].completed()});n=n.filter(function(t){for(var e=0,i=a.length;i>e;++e)if(t[0]===a[e][0])return!1;return!0}),n=n.concat(a),i=i.filter(function(t){return!t[1].completed()}),0!==t.length&&v(w)},b=function(t){var i=t.startState,n=t.endState,o=q(t.duration,500),r=q(t.delay,0),a=t.perspective,s=I(q(t.easing,"linear"),t),h=0===o?n.clone():i.clone();t.transformOrigin;h.transformOrigin=t.transformOrigin;var u,l,c=0,p=0,d=!1,f=!1,m=t.manual,g=0,_=r/o;return l=t.valueFeeder?W(t.valueFeeder,i,n,h):B(i,n,h),{stop:function(){d=!0},isStopped:function(){return d},finish:function(t){m=!1;var e=o*g;c=p-e,u=t,s.resetFrom=g},rollback:function(t){m=!1,l.setReverse();var e=o*(1-g);c=p-e,u=t,s.resetFrom=g},restart:function(){c=e,s.resetFrom(0)},tick:function(t){if(!d){if(m)return p=t,void this.updateCurrentTransform();if(c||(c=t),t-c>r){f=!0,p=t-r;var e=Math.min(Math.max(0,p-c),o);s.tick(e/o),this.updateCurrentTransform(),this.completed()&&u&&u()}}},getCurrentState:function(){return h},setValue:function(t){f=!0,g=Math.min(Math.max(t,1e-4),1+_)},updateCurrentTransform:function(){var t=s.getValue();if(m){var e=Math.max(1e-5,g-_);s.tick(e),t=s.getValue()}l.tween(t)},completed:function(){return d?!0:0===c?!1:s.completed()},updateElement:function(t,e){if(f||e){var i=l.asMatrix(),n=l.getProperties();j(t,i,a),V(t,n)}}}},k=function(t){var i=t.movement;t.initialVelocity=.1,t.equilibriumPosition=0;var n=P(t),o=!1,r=i.position,a=i.rotation,s=i.rotationPost,h=i.scale,u=i.skew,l=H({position:r?[0,0,0]:e,rotation:a?[0,0,0]:e,rotationPost:s?[0,0,0]:e,scale:h?[0,0]:e,skew:u?[0,0]:e});return{stop:function(){o=!0},isStopped:function(t){return o},tick:function(t){o||n.equilibrium||(n.tick(),this.updateMovement())},updateMovement:function(){var t=n.getValue();r&&(l.position[0]=i.position[0]*t,l.position[1]=i.position[1]*t,l.position[2]=i.position[2]*t),a&&(l.rotation[0]=i.rotation[0]*t,l.rotation[1]=i.rotation[1]*t,l.rotation[2]=i.rotation[2]*t),s&&(l.rotationPost[0]=i.rotationPost[0]*t,l.rotationPost[1]=i.rotationPost[1]*t,l.rotationPost[2]=i.rotationPost[2]*t),h&&(l.scale[0]=1+i.scale[0]*t,l.scale[1]=1+i.scale[1]*t),u&&(l.skew[0]=i.skew[0]*t,l.skew[1]=i.skew[1]*t)},updateElement:function(t){j(t,l.asMatrix()),V(t,l.getProperties())},getCurrentState:function(){return l},completed:function(){return n.equilibrium||o},restart:function(){n=P(t)}}},x=function(t){return t},E=function(t){return(Math.cos(t*Math.PI+Math.PI)+1)/2},C=function(t){return t*t},S=function(t){return-Math.pow(t-1,2)+1},P=function(t){var e=q(t.startPosition,0),i=q(t.equilibriumPosition,1),n=q(t.initialVelocity,0),o=q(t.springConstant,.8),r=q(t.springDeceleration,.9),a=q(t.springMass,10),s=!1;return{tick:function(t){if(0!==t&&!s){var h=-(e-i)*o,u=h/a;n+=u,e+=n,n*=r,Math.abs(e-i)<.001&&Math.abs(n)<.001&&(s=!0)}},resetFrom:function(t){e=t,n=0},getValue:function(){return s?i:e},completed:function(){return s}}},O={linear:x,ease:E,easeIn:C,easeOut:S},I=function(t,e){if("spring"==t)return P(e);var i=t;G(t)||(i=O[t]);var n,o=i,r=0;return{tick:function(t){r=o(t),n=t},resetFrom:function(t){n=0},getValue:function(){return r},completed:function(){return n>=1?n:!1}}},M=function(t,e,i,n){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e,t[13]=i,t[14]=n,t[15]=1},T=function(t,e){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=Math.cos(e),t[6]=-Math.sin(e),t[7]=0,t[8]=0,t[9]=Math.sin(e),t[10]=Math.cos(e),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},L=function(t,e){t[0]=Math.cos(e),t[1]=0,t[2]=Math.sin(e),t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=-Math.sin(e),t[9]=0,t[10]=Math.cos(e),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},D=function(t,e){t[0]=Math.cos(e),t[1]=-Math.sin(e),t[2]=0,t[3]=0,t[4]=Math.sin(e),t[5]=Math.cos(e),t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},A=function(t,e,i){t[0]=1,t[1]=Math.tan(e),t[2]=0,t[3]=0,t[4]=Math.tan(i),t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},R=function(t,e,i){t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},F=function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},z=function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]},U=function(){var t=new Float32Array(16),e=new Float32Array(16),i=new Float32Array(16);return F(t),{data:t,asCSS:function(){for(var e="matrix3d(",i=0;15>i;++i)e+=Math.abs(t[i])<1e-4?"0,":t[i].toFixed(10)+",";return e+=Math.abs(t[15])<1e-4?"0)":t[15].toFixed(10)+")"},clear:function(){F(t)},translate:function(n,o,r){return z(t,e),M(i,n,o,r),N(e,i,t),this},rotateX:function(n){return z(t,e),T(i,n),N(e,i,t),this},rotateY:function(n){return z(t,e),L(i,n),N(e,i,t),this},rotateZ:function(n){return z(t,e),D(i,n),N(e,i,t),this},scale:function(n,o){return z(t,e),R(i,n,o),N(e,i,t),this},skew:function(n,o){return z(t,e),A(i,n,o),N(e,i,t),this}}},N=function(t,e,i){return i[0]=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],i[1]=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],i[2]=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],i[3]=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],i[4]=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],i[5]=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],i[6]=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],i[7]=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],i[8]=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],i[9]=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],i[10]=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],i[11]=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],i[12]=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],i[13]=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],i[14]=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],i[15]=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],i},H=function(t){var i=U(),n={opacity:e,width:e,height:e};return{position:t.position,rotation:t.rotation,rotationPost:t.rotationPost,skew:t.skew,scale:t.scale,scalePost:t.scalePost,opacity:t.opacity,width:t.width,height:t.height,clone:function(){return H({position:this.position?this.position.slice(0):e,rotation:this.rotation?this.rotation.slice(0):e,rotationPost:this.rotationPost?this.rotationPost.slice(0):e,skew:this.skew?this.skew.slice(0):e,scale:this.scale?this.scale.slice(0):e,scalePost:this.scalePost?this.scalePost.slice(0):e,height:this.height,width:this.width,opacity:this.opacity})},asMatrix:function(){var t=i;return t.clear(),this.transformOrigin&&t.translate(-this.transformOrigin[0],-this.transformOrigin[1],-this.transformOrigin[2]),this.scale&&t.scale(this.scale[0],this.scale[1]),this.skew&&t.skew(this.skew[0],this.skew[1]),this.rotation&&(t.rotateX(this.rotation[0]),t.rotateY(this.rotation[1]),t.rotateZ(this.rotation[2])),this.position&&t.translate(this.position[0],this.position[1],this.position[2]),this.rotationPost&&(t.rotateX(this.rotationPost[0]),t.rotateY(this.rotationPost[1]),t.rotateZ(this.rotationPost[2])),this.scalePost&&t.scale(this.scalePost[0],this.scalePost[1]),this.transformOrigin&&t.translate(this.transformOrigin[0],this.transformOrigin[1],this.transformOrigin[2]),t},getProperties:function(){return n.opacity=this.opacity,n.width=this.width+"px",n.height=this.height+"px",n}}},B=function(t,i,n){var o=t,r=i,a=n,s=r.position!==e,h=r.rotation!==e,u=r.rotationPost!==e,l=r.scale!==e,c=r.skew!==e,p=r.width!==e,d=r.height!==e,f=r.opacity!==e;return{tween:function(t){if(s){var e=r.position[0]-o.position[0],i=r.position[1]-o.position[1],n=r.position[2]-o.position[2];a.position[0]=o.position[0]+t*e,a.position[1]=o.position[1]+t*i,a.position[2]=o.position[2]+t*n}if(h){var m=r.rotation[0]-o.rotation[0],g=r.rotation[1]-o.rotation[1],_=r.rotation[2]-o.rotation[2];a.rotation[0]=o.rotation[0]+t*m,a.rotation[1]=o.rotation[1]+t*g,a.rotation[2]=o.rotation[2]+t*_}if(u){var v=r.rotationPost[0]-o.rotationPost[0],y=r.rotationPost[1]-o.rotationPost[1],w=r.rotationPost[2]-o.rotationPost[2];a.rotationPost[0]=o.rotationPost[0]+t*v,a.rotationPost[1]=o.rotationPost[1]+t*y,a.rotationPost[2]=o.rotationPost[2]+t*w}if(c){var b=r.scale[0]-o.scale[0],k=r.scale[1]-o.scale[1];a.scale[0]=o.scale[0]+t*b,a.scale[1]=o.scale[1]+t*k}if(l){var x=r.skew[0]-o.skew[0],E=r.skew[1]-o.skew[1];a.skew[0]=o.skew[0]+t*x,a.skew[1]=o.skew[1]+t*E}if(p){var C=r.width-o.width;a.width=o.width+t*C}if(d){var S=r.height-o.height;a.height=o.height+t*S}if(f){var P=r.opacity-o.opacity;a.opacity=o.opacity+t*P}},asMatrix:function(){return a.asMatrix()},getProperties:function(){return a.getProperties()},setReverse:function(){var t=o;o=r,r=t}}},W=function(t,i,n,o){var r=t(0,U()),a=i,s=n,h=o,u=!1;return{tween:function(i){u&&(i=1-i),r.clear(),r=t(i,r);var n=s.width-a.width,o=s.height-a.height,l=s.opacity-a.opacity;s.width!==e&&(h.width=a.width+i*n),s.height!==e&&(h.height=a.height+i*o),s.opacity!==e&&(h.opacity=a.opacity+i*l)},asMatrix:function(){return r},getProperties:function(){return h.getProperties()},setReverse:function(){u=!0}}},q=function(t,e){return"undefined"==typeof t?e:t},j=function(t,e,i){var n="";i&&(n="perspective("+i+"px) ");var r=e.asCSS();t.style[o]=n+r},V=function(t,e){for(var i in e)t.style[i]=e[i]},G=function(t){return"function"==typeof t},J=function(t){if(!t)return t;var e={};for(var i in t)e[i]=t[i];return e};return s.createMatrix=U,s.setElementTransform=j,s}(),tt=function(){function t(t,e,i,n,o){if("string"==typeof t)t=document.getElementById(t);else if(!t instanceof HTMLCanvasElement)return;var r,a=t.getContext("2d");try{try{r=a.getImageData(e,i,n,o)}catch(s){throw new Error("unable to access local image data: "+s)}}catch(s){throw new Error("unable to access image data: "+s)}return r}function e(e,n,o,r,a,s){if(!(isNaN(s)||1>s)){s|=0;var h=t(e,n,o,r,a);h=i(h,n,o,r,a,s),e.getContext("2d").putImageData(h,n,o)}}function i(t,e,i,a,s,h){var u,l,c,p,d,f,m,g,_,v,y,w,b,k,x,E,C,S,P,O,I,M,T,L,D=t.data,A=h+h+1,R=a-1,F=s-1,z=h+1,U=z*(z+1)/2,N=new n,H=N;for(c=1;A>c;c++)if(H=H.next=new n,c==z)var B=H;H.next=N;var W=null,q=null;m=f=0;var j=o[h],V=r[h];for(l=0;s>l;l++){for(E=C=S=P=g=_=v=y=0,w=z*(O=D[f]),b=z*(I=D[f+1]),k=z*(M=D[f+2]),x=z*(T=D[f+3]),g+=U*O,_+=U*I,v+=U*M,y+=U*T,H=N,c=0;z>c;c++)H.r=O,H.g=I,H.b=M,H.a=T,H=H.next;for(c=1;z>c;c++)p=f+((c>R?R:c)<<2),g+=(H.r=O=D[p])*(L=z-c),_+=(H.g=I=D[p+1])*L,v+=(H.b=M=D[p+2])*L,y+=(H.a=T=D[p+3])*L,E+=O,C+=I,S+=M,P+=T,H=H.next;for(W=N,q=B,u=0;a>u;u++)D[f+3]=T=y*j>>V,0!=T?(T=255/T,D[f]=(g*j>>V)*T,D[f+1]=(_*j>>V)*T,D[f+2]=(v*j>>V)*T):D[f]=D[f+1]=D[f+2]=0,g-=w,_-=b,v-=k,y-=x,w-=W.r,b-=W.g,k-=W.b,x-=W.a,p=m+((p=u+h+1)<R?p:R)<<2,E+=W.r=D[p],C+=W.g=D[p+1],S+=W.b=D[p+2],P+=W.a=D[p+3],g+=E,_+=C,v+=S,y+=P,W=W.next,w+=O=q.r,b+=I=q.g,k+=M=q.b,x+=T=q.a,E-=O,C-=I,S-=M,P-=T,q=q.next,f+=4;m+=a}for(u=0;a>u;u++){for(C=S=P=E=_=v=y=g=0,f=u<<2,w=z*(O=D[f]),b=z*(I=D[f+1]),k=z*(M=D[f+2]),x=z*(T=D[f+3]),g+=U*O,_+=U*I,v+=U*M,y+=U*T,H=N,c=0;z>c;c++)H.r=O,H.g=I,H.b=M,H.a=T,H=H.next;for(d=a,c=1;h>=c;c++)f=d+u<<2,g+=(H.r=O=D[f])*(L=z-c),_+=(H.g=I=D[f+1])*L,v+=(H.b=M=D[f+2])*L,y+=(H.a=T=D[f+3])*L,E+=O,C+=I,S+=M,P+=T,H=H.next,F>c&&(d+=a);for(f=u,W=N,q=B,l=0;s>l;l++)p=f<<2,D[p+3]=T=y*j>>V,T>0?(T=255/T,D[p]=(g*j>>V)*T,D[p+1]=(_*j>>V)*T,D[p+2]=(v*j>>V)*T):D[p]=D[p+1]=D[p+2]=0,g-=w,_-=b,v-=k,y-=x,w-=W.r,b-=W.g,k-=W.b,x-=W.a,p=u+((p=l+z)<F?p:F)*a<<2,g+=E+=W.r=D[p],_+=C+=W.g=D[p+1],v+=S+=W.b=D[p+2],y+=P+=W.a=D[p+3],W=W.next,w+=O=q.r,b+=I=q.g,k+=M=q.b,x+=T=q.a,E-=O,C-=I,S-=M,P-=T,q=q.next,f+=a}return t}function n(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var o=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],r=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];return e}(),et=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(){function t(t,i){i=i||{bubbles:!1,cancelable:!1,detail:e};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,i.bubbles,i.cancelable,i.detail),n}t.prototype=window.CustomEvent.prototype,window.CustomEvent=t}(),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){for(var n=atob(this.toDataURL(e,i).split(",")[1]),o=n.length,r=new Uint8Array(o),a=0;o>a;a++)r[a]=n.charCodeAt(a);t(new Blob([r],{type:e||"image/png"}))}});var it={ESC:27,RETURN:13},nt={DOWN:["touchstart","pointerdown","mousedown"],MOVE:["touchmove","pointermove","mousemove"],UP:["touchend","touchcancel","pointerup","mouseup"]},ot={jpeg:"image/jpeg",jpg:"image/jpeg",jpe:"image/jpeg",png:"image/png",gif:"image/gif",bmp:"image/bmp"},rt={n:function(t,e,i,n){var o,r,a,s,h,u,l,c;return a=t.y+t.height,
o=p(e.y,0,a),a-o<i.min.height&&(o=a-i.min.height),h=n?(a-o)/n:t.width,h<i.min.width&&(h=i.min.width,o=a-h*n),l=.5*(h-t.width),s=t.x-l,r=t.x+t.width+l,(0>s||r>i.width)&&(c=Math.min(t.x,i.width-(t.x+t.width)),s=t.x-c,r=t.x+t.width+c,h=r-s,u=h*n,o=a-u),{x:s,y:o,width:r-s,height:a-o}},s:function(t,e,i,n){var o,r,a,s,h,u,l,c;return o=t.y,a=p(e.y,o,i.height),a-o<i.min.height&&(a=o+i.min.height),h=n?(a-o)/n:t.width,h<i.min.width&&(h=i.min.width,a=o+h*n),l=.5*(h-t.width),s=t.x-l,r=t.x+t.width+l,(0>s||r>i.width)&&(c=Math.min(t.x,i.width-(t.x+t.width)),s=t.x-c,r=t.x+t.width+c,h=r-s,u=h*n,a=o+u),{x:s,y:o,width:r-s,height:a-o}},e:function(t,e,i,n){var o,r,a,s,h,u,l,c;return s=t.x,r=p(e.x,s,i.width),r-s<i.min.width&&(r=s+i.min.width),u=n?(r-s)*n:t.height,u<i.min.height&&(u=i.min.height,r=s+u/n),l=.5*(u-t.height),o=t.y-l,a=t.y+t.height+l,(0>o||a>i.height)&&(c=Math.min(t.y,i.height-(t.y+t.height)),o=t.y-c,a=t.y+t.height+c,u=a-o,h=u/n,r=s+h),{x:s,y:o,width:r-s,height:a-o}},w:function xt(t,e,i,n){var o,r,a,s,xt,h,u,l;return r=t.x+t.width,s=p(e.x,0,r),r-s<i.min.width&&(s=r-i.min.width),h=n?(r-s)*n:t.height,h<i.min.height&&(h=i.min.height,s=r-h/n),u=.5*(h-t.height),o=t.y-u,a=t.y+t.height+u,(0>o||a>i.height)&&(l=Math.min(t.y,i.height-(t.y+t.height)),o=t.y-l,a=t.y+t.height+l,h=a-o,xt=h/n,s=r-xt),{x:s,y:o,width:r-s,height:a-o}},ne:function(t,e,i,n){var o,r,a,s,h,u,l;return s=t.x,a=t.y+t.height,r=p(e.x,s,i.width),r-s<i.min.width&&(r=s+i.min.width),u=n?(r-s)*n:p(a-e.y,i.min.height,a),u<i.min.height&&(u=i.min.height,r=s+u/n),o=t.y-(u-t.height),(0>o||a>i.height)&&(l=Math.min(t.y,i.height-(t.y+t.height)),o=t.y-l,u=a-o,h=u/n,r=s+h),{x:s,y:o,width:r-s,height:a-o}},se:function(t,e,i,n){var o,r,a,s,h,u,l;return s=t.x,o=t.y,r=p(e.x,s,i.width),r-s<i.min.width&&(r=s+i.min.width),u=n?(r-s)*n:p(e.y-t.y,i.min.height,i.height-o),u<i.min.height&&(u=i.min.height,r=s+u/n),a=t.y+t.height+(u-t.height),(0>o||a>i.height)&&(l=Math.min(t.y,i.height-(t.y+t.height)),a=t.y+t.height+l,u=a-o,h=u/n,r=s+h),{x:s,y:o,width:r-s,height:a-o}},sw:function(t,e,i,n){var o,r,a,s,h,u,l;return r=t.x+t.width,o=t.y,s=p(e.x,0,r),r-s<i.min.width&&(s=r-i.min.width),u=n?(r-s)*n:p(e.y-t.y,i.min.height,i.height-o),u<i.min.height&&(u=i.min.height,s=r-u/n),a=t.y+t.height+(u-t.height),(0>o||a>i.height)&&(l=Math.min(t.y,i.height-(t.y+t.height)),a=t.y+t.height+l,u=a-o,h=u/n,s=r-h),{x:s,y:o,width:r-s,height:a-o}},nw:function(t,e,i,n){var o,r,a,s,h,u,l;return r=t.x+t.width,a=t.y+t.height,s=p(e.x,0,r),r-s<i.min.width&&(s=r-i.min.width),u=n?(r-s)*n:p(a-e.y,i.min.height,a),u<i.min.height&&(u=i.min.height,s=r-u/n),o=t.y-(u-t.height),(0>o||a>i.height)&&(l=Math.min(t.y,i.height-(t.y+t.height)),o=t.y-l,u=a-o,h=u/n,s=r-h),{x:s,y:o,width:r-s,height:a-o}}},at=function(){function i(){var n=arguments.length<=0||arguments[0]===e?document.createElement("div"):arguments[0];t(this,i),this._element=n,this._interaction=null,this._minWidth=0,this._minHeight=0,this._ratio=null,this._rect={x:0,y:0,width:0,height:0},this._space={width:0,height:0},this._rectChanged=!1,this._init()}return et(i,[{key:"_init",value:function(){this._element.className="amaje-crop-area";var t=r("div","grid");this._element.appendChild(t);for(var e in rt)if(rt.hasOwnProperty(e)){var i=r("button",e);this._element.appendChild(i)}var n=r("button","c");this._element.appendChild(n),a(document,nt.DOWN,this)}},{key:"reset",value:function(){this._interaction=null,this._rect={x:0,y:0,width:0,height:0},this._rectChanged=!0,this._redraw(),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"rescale",value:function(t){1!==t&&(this._interaction=null,this._rectChanged=!0,this._rect.x*=t,this._rect.y*=t,this._rect.width*=t,this._rect.height*=t,this._redraw(),this._element.dispatchEvent(new CustomEvent("change")))}},{key:"limit",value:function(t,e){this._space={width:t,height:e}}},{key:"resize",value:function(t,e,i,n){this._interaction=null,this._rect={x:t,y:e,width:p(i,0,this._space.width),height:p(n,0,this._space.height)},this._rectChanged=!0,this._redraw(),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"handleEvent",value:function(t){switch(t.type){case"touchstart":case"pointerdown":case"mousedown":this._onStartDrag(t);break;case"touchmove":case"pointermove":case"mousemove":this._onDrag(t);break;case"touchend":case"touchcancel":case"pointerup":case"mouseup":this._onStopDrag(t)}}},{key:"_onStartDrag",value:function(t){this._element.contains(t.target)&&(t.preventDefault(),a(document,nt.MOVE,this),a(document,nt.UP,this),this._interaction={type:t.target.className,offset:u(t,this._element)},this._element.setAttribute("data-dragging","true"),this._redraw())}},{key:"_onDrag",value:function(t){t.preventDefault();var e=u(t,this._element.parentNode),i=this._interaction.type;"c"===i?(this._rect.x=p(e.x-this._interaction.offset.x,0,this._space.width-this._rect.width),this._rect.y=p(e.y-this._interaction.offset.y,0,this._space.height-this._rect.height)):rt[i]&&(this._rect=rt[i](this._rect,e,{x:0,y:0,width:this._space.width,height:this._space.height,min:{width:this._minWidth,height:this._minHeight}},this._ratio)),this._rectChanged=!0,this._element.dispatchEvent(new CustomEvent("input"))}},{key:"_onStopDrag",value:function(t){t.preventDefault(),s(document,nt.MOVE,this),s(document,nt.UP,this),this._interaction=null,this._element.setAttribute("data-dragging","false"),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"_redraw",value:function(){var t=this;this._rectChanged&&(this._element.style.cssText="\n                left:"+this._rect.x+"px;\n                top:"+this._rect.y+"px;\n                width:"+this._rect.width+"px;\n                height:"+this._rect.height+"px;\n            ",this._rectChanged=!1),this._interaction&&requestAnimationFrame(function(){return t._redraw()})}},{key:"destroy",value:function(){this._interaction=!1,this._rectChanged=!1,s(document,nt.DOWN,this),s(document,nt.MOVE,this),s(document,nt.UP,this),H(this._element)}},{key:"element",get:function(){return this._element}},{key:"area",get:function(){return this._rect}},{key:"dirty",get:function(){return 0!==this._rect.x||0!==this._rect.y||0!==this._rect.width||0!==this._rect.height}},{key:"minWidth",set:function(t){this._minWidth=t}},{key:"minHeight",set:function(t){this._minHeight=t}},{key:"ratio",set:function(t){this._ratio=t}}]),i}(),st=["cancel","confirm"],ht=["input","change"],ut=function(){function i(){var n=arguments.length<=0||arguments[0]===e?document.createElement("div"):arguments[0],r=arguments.length<=1||arguments[1]===e?{}:arguments[1];t(this,i),this._element=n,this._options=o(i.options(),r),this._ratio=null,this._output=null,this._input=null,this._preview=null,this._previewBlurred=null,this._blurredPreview=!1,this._cropper=null,this._previewWrapper=null,this._currentWindowSize={},this._btnGroup=null,this._init()}return et(i,[{key:"_init",value:function(){var t=this;this._element.className="amaje-image-editor",this._wrapper=r("div","amaje-wrapper"),this._stage=r("div","amaje-stage"),this._wrapper.appendChild(this._stage),this._cropper=new at,ht.forEach(function(e){t._cropper.element.addEventListener(e,t)}),this._stage.appendChild(this._cropper.element),this._previewWrapper=r("div","amaje-image-editor-preview amaje-crop-preview"),this._previewBlurred=r("canvas","amaje-crop-blur"),this._previewWrapper.appendChild(this._previewBlurred),this._wrapper.appendChild(this._previewWrapper),this._preview=r("img","amaje-crop"),this._previewWrapper.appendChild(this._preview),this._btnGroup=r("div","amaje-btn-group"),st.forEach(function(e){var i=l(e),n=t._options["button"+i+"Label"],o=t._options["button"+i+"Title"],a=t._options["button"+i+"ClassName"],s=r("button","amaje-image-editor-btn amaje-btn-"+e+(a?" "+a:""));s.innerHTML=n,s.title=o||n,s.type="button",s.setAttribute("data-action",e),s.addEventListener("click",t),t._btnGroup.appendChild(s)}),this._element.appendChild(this._wrapper),this._element.appendChild(this._btnGroup)}},{key:"handleEvent",value:function(t){switch(t.type){case"click":this._onClick(t);break;case"change":this._onGridChange(t);break;case"input":this._onGridInput(t);break;case"keydown":this._onKeyDown(t);break;case"resize":this._onResize(t)}}},{key:"_onKeyDown",value:function(t){switch(t.keyCode){case it.RETURN:this._confirm();break;case it.ESC:this._cancel()}}},{key:"_onClick",value:function(t){t.target.classList.contains("amaje-btn-cancel")&&this._cancel(),t.target.classList.contains("amaje-btn-confirm")&&this._confirm()}},{key:"_onResize",value:function(){var t=this;this._currentWindowSize={width:window.innerWidth,height:window.innerHeight},clearTimeout(this._resizeTimer),this._resizeTimer=setTimeout(function(){requestAnimationFrame(function(){t._reflow()})},10)}},{key:"_reflow",value:function(){var t=this._wrapper.offsetWidth;this._redraw(),this._cropper.rescale(this._wrapper.offsetWidth/t)}},{key:"_onGridInput",value:function(){this._maskOriginal()}},{key:"_onGridChange",value:function(){this._maskOriginal()}},{key:"_cancel",value:function(){this._element.dispatchEvent(new CustomEvent("cancel"))}},{key:"_confirm",value:function(){this._element.dispatchEvent(new CustomEvent("confirm",{detail:{crop:T(this._cropper.area,this._input.width/this._preview.width)}}))}},{key:"open",value:function(t,e,i,n){var o=this;if(this._input&&this._input.getAttribute("data-file")==t.getAttribute("data-file"))return void n();this._blurredPreview=!1,this._input=t,this._preview.onload=function(){o._redraw(),requestAnimationFrame(function(){var t=o.ratio;o._cropper.minWidth=o._options.minSize.width*o.scalar,o._cropper.minHeight=o._options.minSize.height*o.scalar,o._cropper.ratio=t;var e=o._stage.getBoundingClientRect();o._cropper.limit(e.width,e.height),o._cropper.resize(i.x*o.scalar,i.y*o.scalar,i.width*o.scalar,i.height*o.scalar),n(),o._element.style.opacity=""})};var r=Math.min(this._element.offsetWidth/this._input.width,this._element.offsetHeight/this._input.height);this._preview.src=S(this._input,r).toDataURL(),this._element.style.opacity="0",this._ratio=e}},{key:"_maskOriginal",value:function(){var t=this,e=this._cropper.area;requestAnimationFrame(function(){t._preview.style.clip="rect("+e.y+"px,"+(e.x+e.width)+"px,"+(e.y+e.height)+"px,"+e.x+"px)"})}},{key:"_reset",value:function(){this._blurredPreview=!1,this._preview.src="",I(this._previewBlurred),this._cropper.reset()}},{key:"_redraw",value:function(){var t=this._input.height/this._input.width,e=this._btnGroup.offsetHeight,i=this._element.clientWidth,n=this._element.clientHeight-e,o=i,r=o*t;r>n&&(r=n,o=r/t),o=Math.round(o),r=Math.round(r),this._previewBlurred.style.cssText=this._wrapper.style.cssText="\n            width:"+o+"px;\n            height:"+r+"px;\n        ",this._preview.width=o,this._preview.height=r,this._blurredPreview||(this._previewBlurred.width=300,this._previewBlurred.height=this._previewBlurred.width*t,O(this._input,this._previewBlurred),M(this._previewBlurred,3),this._blurredPreview=!0)}},{key:"show",value:function(){var t=arguments.length<=0||arguments[0]===e?function(){}:arguments[0];this._currentWindowSize.width===window.innerWidth&&this._currentWindowSize.height===window.innerHeight||this._reflow(),document.addEventListener("keydown",this),window.addEventListener("resize",this),Q(this._previewWrapper,{fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:.9999,fromScale:[.98,.98],scale:[1,1],easing:"spring",springConstant:.3,springDeceleration:.85,delay:450,complete:function(){m(this)}}),this._cropper.dirty?Q(this._stage,{fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:1,duration:250,delay:550,complete:function(){m(this),t()}}):Q(this._stage,{fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:1,duration:250,delay:1e3,complete:function(){m(this)}}),Q(this._btnGroup.childNodes,{fromScale:[.9,.9],scale:[1,1],fromOpacity:0,opacity:1,delay:function(t){return 1e3+100*t},easing:"spring",springConstant:.3,springDeceleration:.85,complete:function(){m(this)}})}},{key:"hide",value:function(){var t=arguments.length<=0||arguments[0]===e?function(){}:arguments[0];document.removeEventListener("keydown",this),window.removeEventListener("resize",this),Q(this._btnGroup.childNodes,{fromOpacity:1,opacity:0,duration:350}),Q([this._stage,this._previewWrapper],{fromPosition:[0,0,0],position:[0,-250,0],fromOpacity:1,opacity:0,easing:"spring",springConstant:.3,springDeceleration:.75,delay:250,allDone:function(){t()}})}},{key:"destroy",value:function(){var t=this;N(this._btnGroup.children).forEach(function(e){e.removeEventListener("click",t)}),ht.forEach(function(e){t._cropper.element.removeEventListener(e,t)}),this._cropper.destroy(),H(this._element)}},{key:"element",get:function(){return this._element}},{key:"ratio",get:function(){return"input"===this._ratio?this._input.height/this._input.width:this._ratio}},{key:"offset",get:function(){return this._element.getBoundingClientRect()}},{key:"original",get:function(){return this._input}},{key:"scalar",get:function(){return this._preview.width/this._input.width}}],[{key:"options",value:function(){return{buttonCancelClassName:null,buttonConfirmClassName:null,buttonCancelLabel:"Cancel",buttonConfirmLabel:"Confirm",buttonCancelTitle:null,buttonConfirmTitle:null,minSize:{width:0,height:0}}}}]),i}(),lt=["dragover","dragleave","drop"],ct=function(){function i(){var n=arguments.length<=0||arguments[0]===e?document.createElement("div"):arguments[0];t(this,i),this._element=n,this._accept=[],this._dragPath=null,this._init()}return et(i,[{key:"areValidFiles",value:function(t){return this._accept.length&&t?-1!=this._accept.indexOf(t[0].type):!0}},{key:"reset",value:function(){this._element.files=null}},{key:"_init",value:function(){var t=this;this._element.className="amaje-file-hopper",lt.forEach(function(e){t._element.addEventListener(e,t)})}},{key:"handleEvent",value:function(t){switch(t.type){case"dragover":this._onDragOver(t);break;case"dragleave":this._onDragLeave(t);break;case"drop":this._onDrop(t)}}},{key:"_onDrop",value:function(t){return t.preventDefault(),this.areValidFiles(t.dataTransfer.files)?(this._element.files=t.dataTransfer.files,this._element.dispatchEvent(new CustomEvent("file-drop",{detail:n(t)})),this._element.dispatchEvent(new CustomEvent("change")),void(this._dragPath=null)):(this._element.dispatchEvent(new CustomEvent("file-invalid-drop")),void(this._dragPath=null))}},{key:"_onDragOver",value:function(t){return t.preventDefault(),t.dataTransfer.dropEffect="copy",this.areValidFiles(t.dataTransfer.items)?(this._dragPath||(this._dragPath=[]),this._dragPath.push(n(t)),void this._element.dispatchEvent(new CustomEvent("file-over",{detail:{x:c(this._dragPath).x,y:c(this._dragPath).y}}))):(t.dataTransfer.dropEffect="none",void this._element.dispatchEvent(new CustomEvent("file-invalid")))}},{key:"_onDragLeave",value:function(t){this._element.dispatchEvent(new CustomEvent("file-out",{detail:n(t)})),this._dragPath=null}},{key:"destroy",value:function(){var t=this;lt.forEach(function(e){t._element.removeEventListener(e,t)}),H(this._element)}},{key:"element",get:function(){return this._element}},{key:"dragPath",get:function(){return this._dragPath}},{key:"enabled",get:function(){return""===this._element.style.display},set:function(t){this._element.style.display=t?"":"none"}},{key:"accept",set:function(t){this._accept=t},get:function(){return this._accept}}]),i}(),pt=function(){function i(){t(this,i),this._element=null,this._inner=null,this._init()}return et(i,[{key:"_init",value:function(){this._element=r("div","amaje-popover"),this._element.setAttribute("data-state","off"),document.body.appendChild(this._element)}},{key:"show",value:function(){var t=this,i=arguments.length<=0||arguments[0]===e?function(){}:arguments[0];this._element.setAttribute("data-state","on"),Q(this._element,{fromOpacity:0,opacity:1,duration:350,complete:function(){m(t._element),i()}})}},{key:"hide",value:function(){var t=this,i=arguments.length<=0||arguments[0]===e?function(){}:arguments[0];Q(this._element,{fromOpacity:1,opacity:0,duration:500,complete:function(){m(t._element),t._element.setAttribute("data-state","off"),i()}})}},{key:"destroy",value:function(){this._element.parentNode&&this._element.parentNode.removeChild(this._element)}},{key:"inner",set:function(t){this._inner=t,this._element.firstChild&&this._element.removeChild(this._element.firstChild),this._element.appendChild(this._inner)}}]),i}(),dt={AUTO:"auto",INITIAL:"initial",MANUAL:"manual"},ft=["x","y","width","height"],mt=["file-invalid-drop","file-invalid","file-drop","file-over","file-out","click"],gt=["cancel","confirm"],_t=null,vt=0,yt=["remove","edit","download","upload"],wt='\n<div class="amaje-loader">\n    <svg>\n        <path class="amaje-loader-background" fill="none" stroke-width="3" />\n        <path class="amaje-loader-foreground" fill="none" stroke-width="3" />\n    </svg>\n</div>\n',bt='\n<div class="amaje-upload-status"></div>\n',kt=function(){function n(r){var a=arguments.length<=1||arguments[1]===e?{}:arguments[1];t(this,n),_t||(_t=new pt),vt++,this._options=o(n.options(),a),this._originalElement=r,this._originalElementInner=r.innerHTML,this._originalElementAttributes=i(r),G(r)?this._element=r:(this._element=B(r),this._element.className=r.className,r.className="",this._element.setAttribute("data-ratio",this._options.ratio)),this._element.classList.add("amaje"),this._element.setAttribute("data-state","init"),this._input=null,this._output=null,this._ratio=null,this._isRequired=!1,this._imageHopper=null,this._imageEditor=null,this._progressEnabled=!0,this._data={},this._resetData(),this._state=[],this._drip=null,this._hasInitialImage=!1,this._initialCrop=this._options.crop,this._isBeingDestroyed=!1,n.supported?this._init():this._fallback()}return et(n,[{key:"isAttachedTo",value:function(t){return this._element===t||this._originalElement===t}},{key:"isDetached",value:function(){return null===this._element.parentNode}},{key:"load",value:function(t,i,n){i===e&&(i={}),"function"==typeof i?n=i:(this._options.crop=i.crop,this._initialCrop=this._options.crop),this._load(t,n)}},{key:"upload",value:function(t){this._doUpload(t)}},{key:"download",value:function(){this._doDownload()}},{key:"remove",value:function(){return this._doRemove()}},{key:"destroy",value:function(){this._doDestroy()}},{key:"_getFileInput",value:function(){return this._element.querySelector("input[type=file]")}},{key:"_getInitialImage",value:function(){return this._element.querySelector("img")}},{key:"_getInputElement",value:function(){return this._getFileInput()||this._getInitialImage()}},{key:"_getRatioSpacerElement",value:function(){return this._element.children[0]}},{key:"_isImageOnly",value:function(){return"INPUT"!==this._input.nodeName}},{key:"_isFixedRatio",value:function(){return-1!==this._options.ratio.indexOf(":")}},{key:"_toggleButton",value:function(t,e){U('.amaje-btn[data-action="'+t+'"]',e,this._element)}},{key:"_clearState",value:function(){this._state=[],this._updateState()}},{key:"_removeState",value:function(t){this._state=this._state.filter(function(e){return e!==t}),this._updateState()}},{key:"_addState",value:function(t){d(t,this._state)||(this._state.push(t),this._updateState())}},{key:"_updateState",value:function(){this._element.setAttribute("data-state",this._state.join(","))}},{key:"_resetData",value:function(){this._data={server:null,meta:null,input:{image:null,name:null,type:null,width:0,height:0},output:{image:null,width:0,height:0},actions:{crop:null,size:null}},this._output&&(this._output.value=""),D(this._getFileInput())}},{key:"_init",value:function(){var t=this;this._addState("empty"),this._input=this._getInputElement(),this._input||(this._input=r("input"),this._input.type="file",this._element.appendChild(this._input)),this._isRequired=this._input.required===!0,this._output=this._element.querySelector("input[type=hidden]"),this._output||(this._output=r("input"),this._output.type="hidden",this._output.name=this._input.name||this._options.defaultInputName,this._element.appendChild(this._output)),this._input.removeAttribute("name");var i=r("div","amaje-area"),n=this._getInitialImage(),o=(n||{}).src;o?this._hasInitialImage=!0:this._initialCrop=null;var a='\n        <div class="amaje-result">\n            <img class="in" style="opacity:0" '+(o?'src="'+o+'"':"")+'><img><img style="opacity:0">\n        </div>';if(this._isImageOnly())i.innerHTML="\n                "+wt+"\n                "+bt+"\n                "+a+"\n            ";else{var s=e;this._input.hasAttribute("accept")?s=this._input.accept.split(",").filter(function(t){return t.length>0}):(s=_(),this._input.setAttribute("accept",s.join(","))),this._imageHopper=new ct,this._imageHopper.accept=s,this._element.appendChild(this._imageHopper.element),mt.forEach(function(e){t._imageHopper.element.addEventListener(e,t)}),i.innerHTML="\n                "+wt+"\n                "+bt+'\n                <div class="amaje-drip"><span><span></span></span></div>\n                <div class="amaje-status"><div class="amaje-label">'+(this._options.label||"")+"</div></div>\n                "+a+"\n            ",this._input.addEventListener("change",this)}if(this._element.appendChild(i),this._btnGroup=r("div","amaje-btn-group"),this._btnGroup.style.display="none",this._element.appendChild(this._btnGroup),yt.filter(function(e){return t._isButtonAllowed(e)}).forEach(function(e){var i=l(e),n=t._options["button"+i+"Label"],o=t._options["button"+i+"Title"]||n,a=t._options["button"+i+"ClassName"],s=r("button","amaje-btn amaje-btn-"+e+(a?" "+a:""));s.innerHTML=n,s.title=o,s.type="button",s.addEventListener("click",t),s.setAttribute("data-action",e),t._btnGroup.appendChild(s)}),this._isFixedRatio()){var h=V(this._options.ratio,":");this._ratio=h[1]/h[0],this._scaleDropArea(this._ratio)}this._updateProgress(.5),o?this._load(o,function(){t._onInit()}):this._onInit()}},{key:"_onInit",value:function(){var t=this;setTimeout(function(){t._options.onInit(t)},0)}},{key:"_updateProgress",value:function(t){if(this._progressEnabled){var e=this._element.querySelector(".amaje-loader");if(e){var i=e.getBoundingClientRect(),n=e.querySelectorAll("path"),o=parseInt(n[0].getAttribute("stroke-width"),10);n[0].setAttribute("d",j(.5*i.width,.5*i.height,.5*i.width-o,.9999)),n[1].setAttribute("d",j(.5*i.width,.5*i.height,.5*i.width-o,t))}}}},{key:"_startProgress",value:function(){var t=this;this._progressEnabled=!1;var e=this._element.querySelector(".amaje-loader");if(e){var i=e.children[0];this._stopProgressLoop(function(){e.removeAttribute("style"),i.removeAttribute("style"),t._progressEnabled=!0,t._updateProgress(0),t._progressEnabled=!1,Q(i,{fromOpacity:0,opacity:1,duration:250,complete:function(){t._progressEnabled=!0}})})}}},{key:"_stopProgress",value:function(){var t=this,e=this._element.querySelector(".amaje-loader");if(e){var i=e.children[0];this._updateProgress(1),Q(i,{fromOpacity:1,opacity:0,duration:250,complete:function(){e.removeAttribute("style"),i.removeAttribute("style"),t._updateProgress(.5),t._progressEnabled=!1}})}}},{key:"_startProgressLoop",value:function(){var t=this._element.querySelector(".amaje-loader");if(t){var e=t.children[0];t.removeAttribute("style"),e.removeAttribute("style"),this._updateProgress(.5);var i=1e3;Q(t,{rotation:[0,0,-(2*Math.PI)*i],easing:"linear",duration:1e3*i}),Q(e,{fromOpacity:0,opacity:1,duration:250})}}},{key:"_stopProgressLoop",value:function(t){var e=this._element.querySelector(".amaje-loader");if(e){var i=e.children[0];Q(i,{fromOpacity:parseFloat(i.style.opacity),opacity:0,duration:250,complete:function(){Q(e,"stop"),t&&t()}})}}},{key:"_isButtonAllowed",value:function(t){return"edit"===t?this._options.edit:"download"===t?this._options.download:"upload"===t?this._options.service?!this._options.push:!1:"remove"===t?!this._isImageOnly():!0}},{key:"_fallback",value:function(){this._removeState("init");var t=r("div","amaje-area");t.innerHTML='\n            <div class="amaje-status"><div class="amaje-label">'+(this._options.label||"")+"</div></div>\n        ",this._element.appendChild(t),this._throwError(this._options.statusNoSupport)}},{key:"handleEvent",value:function(t){switch(t.type){case"click":this._onClick(t);break;case"change":this._onChange(t);break;case"cancel":this._onCancel(t);break;case"confirm":this._onConfirm(t);break;case"file-over":this._onFileOver(t);break;case"file-out":this._onFileOut(t);break;case"file-drop":this._onDropFile(t);break;case"file-invalid":this._onInvalidFile(t);break;case"file-invalid-drop":this._onInvalidFileDrop(t)}}},{key:"_getIntro",value:function(){return this._element.querySelector(".amaje-result .in")}},{key:"_getOutro",value:function(){return this._element.querySelector(".amaje-result .out")}},{key:"_getInOut",value:function(){return this._element.querySelectorAll(".amaje-result img")}},{key:"_getDrip",value:function(){return this._drip||(this._drip=this._element.querySelector(".amaje-drip > span")),this._drip}},{key:"_throwError",value:function(t){this._addState("error"),this._element.querySelector(".amaje-label").style.display="none";var e=this._element.querySelector(".amaje-error");e||(e=r("div","amaje-error"),this._element.querySelector(".amaje-status").appendChild(e)),e.innerHTML=t}},{key:"_removeError",value:function(){this._removeState("error"),this._element.querySelector(".amaje-label").style.display="";var t=this._element.querySelector(".amaje-error");t&&t.parentNode.removeChild(t)}},{key:"_openFileDialog",value:function(){this._input.click()}},{key:"_onClick",value:function(t){var e=this,i=t.target.classList,n=t.target;if(i.contains("amaje-file-hopper"))return void this._openFileDialog();switch(n.getAttribute("data-action")){case"remove":this._options.onBeforeRemove(this,function(){e._doRemove()});break;case"edit":this._doEdit();break;case"download":this._doDownload();break;case"upload":this._doUpload()}}},{key:"_onInvalidFileDrop",value:function(){this._onInvalidFile(),this._removeState("file-over");var t=this._getDrip();Q(t.firstChild,{fromScale:[.5,.5],scale:[0,0],fromOpacity:.5,opacity:0,duration:150,complete:function(){m(t.firstChild)}})}},{key:"_onInvalidFile",value:function(){var t=this._imageHopper.accept.map(v),e=this._options.statusFileType.replace("$0",t.join(", "));this._throwError(e)}},{key:"_onOverWeightFile",value:function(){var t=this._options.statusFileSize.replace("$0",this._options.maxFileSize);this._throwError(t)}},{key:"_onFileOver",value:function(t){this._addState("file-over"),this._removeError();var e=this._getDrip(),i=Q.createMatrix();i.translate(t.detail.x,t.detail.y,0),Q.setElementTransform(e,i),1==this._imageHopper.dragPath.length&&(e.style.opacity=1,Q(e.firstChild,{fromOpacity:0,opacity:.5,fromScale:[0,0],scale:[.5,.5],duration:150}))}},{key:"_onFileOut",value:function(t){this._removeState("file-over"),this._removeState("file-invalid"),this._removeError();var e=this._getDrip(),i=Q.createMatrix();i.translate(t.detail.x,t.detail.y,0),Q.setElementTransform(e,i),Q(e.firstChild,{fromScale:[.5,.5],scale:[0,0],fromOpacity:.5,opacity:0,duration:150,complete:function(){m(e.firstChild)}})}},{key:"_onDropFile",value:function(t){var e=this;this._removeState("file-over");var i=this._getDrip(),n=Q.createMatrix();n.translate(t.detail.x,t.detail.y,0),Q.setElementTransform(i,n);var o=this._imageHopper.dragPath.length,r=this._imageHopper.dragPath[o-Math.min(10,o)],a=t.detail.x-r.x,s=t.detail.y-r.y;Q(i,{fromPosition:[t.detail.x,t.detail.y,0],position:[t.detail.x+a,t.detail.y+s,0],duration:200}),Q(i.firstChild,{fromScale:[.5,.5],scale:[2,2],fromOpacity:1,opacity:0,duration:200,complete:function(){m(i.firstChild),e._load(t.target.files[0])}})}},{key:"_onChange",value:function(t){this._load(t.target.files[0])}},{key:"_load",value:function(t,e){var i=this;if(!this._isBeingDestroyed){var n=w(t);if(n.size&&this._options.maxFileSize&&g(n.size)>this._options.maxFileSize)return this._onOverWeightFile(),void(e&&e("file-too-big"));this._removeState("empty"),this._imageHopper&&(this._imageHopper.enabled=!1),this._data.input.name=n.name,this._data.input.type=n.type,this._data.input.size=n.size,this._startProgressLoop(),this._addState("busy"),b(t,function(t,o){return t?(t.setAttribute("data-file",n.name),void i._loadCanvas(t,function(){var t=i._getIntro(),n={fromScale:[1.25,1.25],scale:[1,1],fromOpacity:0,opacity:1,complete:function(){m(t),t.style.opacity=1,i._showButtons(),i._stopProgressLoop(),i._removeState("busy"),i._addState("preview"),e&&e(null,i.data)}};i.isDetached()?n.duration=1:(n.easing="spring",n.springConstant=.3,n.springDeceleration=.7),Q(t,n)})):(i._removeState("busy"),i._stopProgressLoop(),i._resetData(),void(e&&e("file-not-found")))})}}},{key:"_loadCanvas",value:function(t,e){var i=this;this._isBeingDestroyed||(this._isFixedRatio()||(this._ratio=t.height/t.width,this._scaleDropArea(this._ratio)),this._data.input.image=t,this._data.input.width=t.width,this._data.input.height=t.height,this._initialCrop?(this._data.actions.crop=A(this._initialCrop),this._data.actions.crop.type=dt.INITIAL,this._initialCrop=null):(this._data.actions.crop=k(t.width,t.height,this._ratio),this._data.actions.crop.type=dt.AUTO),this._options.size&&(this._data.actions.size={width:this._options.size.width,height:this._options.size.height}),this._applyTransforms(t,function(t){var n=i._getIntro(),o=n.offsetWidth/t.width,r=!1;i._options.service&&i._options.push&&(i._hasInitialImage||(r=!0)),i._save(function(){},r),n.src=S(t,o).toDataURL(),n.onload=function(){n.onload=null,i._isBeingDestroyed||e&&e()}}))}},{key:"_applyTransforms",value:function(t,e){var i=this;x(t,this._data.actions,function(t){i._data.output.width=t.width,i._data.output.height=t.height,i._data.output.image=t,i._onTransformCanvas(i._data,function(t){i._data=t,e(i._data.output.image)})})}},{key:"_onTransformCanvas",value:function(t,e){this._options.onTransform(R(t),e)}},{key:"_appendEditor",value:function(){var t=this;this._imageEditor||(this._imageEditor=new ut(r("div"),{minSize:this._options.minSize,buttonConfirmClassName:"amaje-btn-confirm",buttonCancelClassName:"amaje-btn-cancel",buttonConfirmLabel:this._options.buttonConfirmLabel,buttonCancelLabel:this._options.buttonCancelLabel,buttonConfirmTitle:this._options.buttonConfirmTitle,buttonCancelTitle:this._options.buttonCancelTitle}),gt.forEach(function(e){t._imageEditor.element.addEventListener(e,t)}))}},{key:"_scaleDropArea",value:function(t){var e=this._getRatioSpacerElement();e.style.marginBottom=100*t+"%",this._element.setAttribute("data-ratio","1:"+t)}},{key:"_onCancel",value:function(t){this._removeState("editor"),this._showButtons(),this._hideEditor()}},{key:"_onConfirm",value:function(t){var e=this;this._removeState("editor"),this._startProgressLoop(),this._addState("busy"),this._output.value="",this._data.actions.crop=t.detail.crop,this._data.actions.crop.type=dt.MANUAL,this._applyTransforms(this._data.input.image,function(t){var i=e._getInOut(),n="out"===i[0].className?i[0]:i[1],o=n===i[0]?i[1]:i[0];n.className="in",n.style.opacity="0",n.style.zIndex="2",o.className="out",o.style.zIndex="1",n.src=S(t,n.offsetWidth/t.width).toDataURL(),n.onload=function(){n.onload=null,"free"===e._options.ratio&&(e._ratio=n.naturalHeight/n.naturalWidth,e._scaleDropArea(e._ratio)),e._hideEditor(),setTimeout(function(){e._showPreview(n,function(){var t=e._options.service&&e._options.push;e._save(function(t,i){e._toggleButton("upload",!0),e._stopProgressLoop(),e._removeState("busy"),e._showButtons(),i&&i.path&&(n.src=i.path)},t)})},250)}})}},{key:"_save",value:function(){var t=this,i=arguments.length<=0||arguments[0]===e?function(){}:arguments[0],n=arguments.length<=1||arguments[1]===e?!0:arguments[1],o=z(this._data,this._options.post);this._options.onSave(o,function(e){t._output&&!t._options.service&&t._store(e),t._options.service&&n&&t._upload(e,function(e,n){e||t._storeServerResponse(n),t._options.onComplete(e,n),i(e,n)}),t._options.service&&n||i()})}},{key:"_storeServerResponse",value:function(t){this._isRequired&&(this._input.required=!1),this._data.server=t,this._output.value="object"==typeof t?JSON.stringify(this._data.server):t;
}},{key:"_store",value:function(t){this._isRequired&&(this._input.required=!1),this._output.value=JSON.stringify(t)}},{key:"_upload",value:function(t,e){var i=this,n=new FormData;n.append(this._output.name,JSON.stringify(t));var o=this._element.querySelector(".amaje-upload-status");f(this._options.service,n,function(t,e){i._updateProgress(t/e)},function(t){setTimeout(function(){o.innerHTML=i._options.statusUploadSuccess,o.setAttribute("data-state","success"),o.style.opacity=1,setTimeout(function(){o.style.opacity=0},2e3)},250),e(null,t)},function(t){var n="";n="file-too-big"===t?i._options.statusContentLength:i._options.statusUnknownResponse,setTimeout(function(){o.innerHTML=n,o.setAttribute("data-state","error"),o.style.opacity=1},250),e(t)})}},{key:"_showEditor",value:function(){_t.show(),this._imageEditor.show()}},{key:"_hideEditor",value:function(){this._imageEditor.hide(),setTimeout(function(){_t.hide()},250)}},{key:"_showPreview",value:function(t,e){Q(t,{fromPosition:[0,50,0],position:[0,0,0],fromScale:[1.5,1.5],scale:[1,1],fromOpacity:0,opacity:1,easing:"spring",springConstant:.3,springDeceleration:.7,complete:function(){m(t),e&&e()}})}},{key:"_hideResult",value:function(t){var e=this._getIntro();e&&Q(e,{fromScale:[1,1],scale:[.5,.5],fromOpacity:1,opacity:0,easing:"spring",springConstant:.3,springDeceleration:.75,complete:function(){m(e),t&&t()}})}},{key:"_showButtons",value:function(t){this._btnGroup.style.display="";var e={fromScale:[.5,.5],scale:[1,1],fromPosition:[0,10,0],position:[0,0,0],fromOpacity:0,opacity:1,complete:function(){m(this)},allDone:function(){t&&t()}};this.isDetached()?e.duration=1:(e.delay=function(t){return 250+50*t},e.easing="spring",e.springConstant=.3,e.springDeceleration=.85),Q(this._btnGroup.childNodes,e)}},{key:"_hideButtons",value:function(t){var e=this,i={fromScale:[1,1],scale:[.85,.85],fromOpacity:1,opacity:0,allDone:function(){e._btnGroup.style.display="none",t&&t()}};this.isDetached()?i.duration=1:(i.easing="spring",i.springConstant=.3,i.springDeceleration=.75),Q(this._btnGroup.childNodes,i)}},{key:"_hideStatus",value:function(){var t=this._element.querySelector(".amaje-upload-status");t.style.opacity=0}},{key:"_doEdit",value:function(){var t=this;this._data.input.image&&(this._addState("editor"),this._imageEditor||this._appendEditor(),_t.inner=this._imageEditor.element,this._imageEditor.open(C(this._data.input.image),"free"===this._options.ratio?null:this._ratio,this._data.actions.crop,function(){t._showEditor(),t._hideButtons(),t._hideStatus()}))}},{key:"_doRemove",value:function(){var t=this;if(!this._isImageOnly()){this._clearState(),this._addState("empty"),this._hasInitialImage=!1,this._imageHopper.enabled=!0,this._isRequired&&(this._input.required=!0);var e=this._getOutro();e&&(e.style.opacity="0");var i=this.data;return this._resetData(),setTimeout(function(){t._isBeingDestroyed||(t._hideButtons(function(){t._toggleButton("upload",!0)}),t._hideStatus(),t._hideResult(),t._options.onRemove(t,i))},this.isDetached()?0:250),i}}},{key:"_doUpload",value:function(t){var e=this;this._data.input.image&&(this._addState("upload"),this._startProgress(),this._hideButtons(function(){e._toggleButton("upload",!1),e._save(function(i,n){e._removeState("upload"),e._stopProgress(),t&&t(i,n),i&&e._toggleButton("upload",!0),e._showButtons()})}))}},{key:"_doDownload",value:function(){var t=this._data.output.image;if(t){var e=this._data.input.name,i=this._data.input.type;t.toBlob(function(t){var i=r("a");i.download=e,i.href=URL.createObjectURL(t),i.click()},i)}}},{key:"_doDestroy",value:function(){function t(t,e){return 0!==e.filter(function(e){return t.name===e.name&&t.value===e.value}).length}var e=this;this._isBeingDestroyed=!0,this._imageHopper&&(mt.forEach(function(t){e._imageHopper.element.removeEventListener(t,e)}),this._imageHopper.destroy()),this._imageEditor&&(gt.forEach(function(t){e._imageEditor.element.removeEventListener(t,e)}),this._imageEditor.destroy()),N(this._btnGroup.children).forEach(function(t){t.removeEventListener("click",e)}),this._input.removeEventListener("change",this),this._element!==this._originalElement&&this._element.parentNode&&this._element.parentNode.replaceChild(this._originalElement,this._element),this._originalElement.innerHTML=this._originalElementInner;var n=i(this._originalElement);n.forEach(function(i){t(i,e._originalElementAttributes)||e._originalElement.removeAttribute(i.name)}),this._originalElementAttributes.forEach(function(i){t(i,n)||e._originalElement.setAttribute(i.name,i.value)}),vt=Math.max(0,vt-1),_t&&0===vt&&(_t.destroy(),_t=null)}},{key:"data",get:function(){return R(this._data)}}],[{key:"options",value:function(){var t={edit:!0,ratio:"free",size:null,crop:null,post:["output","actions"],service:null,push:!1,defaultInputName:"amaje[]",minSize:{width:100,height:100},maxFileSize:null,download:!1,label:"<p>Drop your image here</p>",statusFileType:"<p>Invalid file type, expects: $0.</p>",statusFileSize:"<p>File is too big, maximum file size: $0 MB.</p>",statusNoSupport:"<p>Your browser does not support image cropping.</p>",statusContentLength:'<span class="amaje-upload-status-icon"></span> The file is probably too big',statusUnknownResponse:'<span class="amaje-upload-status-icon"></span> An unknown error occurred',statusUploadSuccess:'<span class="amaje-upload-status-icon"></span> Saved',onInit:function(t){},onTransform:function(t,e){e(t)},onSave:function(t,e){e(t)},onComplete:function(t,e){},onBeforeRemove:function(t,e){e()},onRemove:function(t,e){}};return yt.concat(st).forEach(function(e){var i=l(e);t["button"+i+"ClassName"]=null,t["button"+i+"Label"]=i,t["button"+i+"Title"]=null}),t}}]),n}();return function(){function t(t,e){return t.getAttribute("data-"+e)}function e(t){return t.replace(/([a-z](?=[A-Z]))/g,"$1-").toLowerCase()}function i(t){return"object"==typeof t?JSON.parse(JSON.stringify(t)):t}function n(t){return t?"<p>"+t+"</p>":null}function o(t){var e=window,i=t.split(".");return i.forEach(function(t,n){e=e[i[n]]}),e}var r=[],a=function(t){for(var e=0,i=r.length;i>e;e++)if(r[e].isAttachedTo(t))return e;return-1},s=function(t,e){return e},h=function(t,e){return"true"===e},u=function(t,e){return e?"true"===e:!0},c=function(t,e){return n(e)},p=function(t,e){return e?o(e):null},d=function(t,e){if(!e)return null;var i=V(e,",");return{width:i[0],height:i[1]}},f=function(t,e){if(!e)return null;var i={};return e.split(",").map(function(t){return parseInt(t,10)}).forEach(function(t,e){i[ft[e]]=t}),i},m={download:h,edit:u,minSize:d,size:d,service:function(t,e){return"undefined"==typeof e?null:e},push:h,crop:f,post:function(t,e){return e?e.split(",").map(function(t){return t.trim()}):null},defaultInputName:s,ratio:function(t,e){return e?e:null},maxFileSize:function(t,e){return e?parseFloat(e):null},label:c};["FileSize","FileType","NoSupport"].forEach(function(t){m["status"+t]=c}),["ContentLength","UnknownResponse","UploadSuccess"].forEach(function(t){m["status"+t]=s}),["Init","Transform","Save","Complete","BeforeRemove","Remove"].forEach(function(t){m["on"+t]=p});var g=["ClassName","Label","Title"];yt.concat(st).forEach(function(t){var e=l(t);g.forEach(function(t){m["button"+e+t]=s})}),kt.supported=function(){return"undefined"!=typeof window.FileReader}(),kt.parse=function(n){var o,r,a,s,h,u,l=[];for(o=n.querySelectorAll(".amaje:not([data-state])"),a=o.length;a--;){r=o[a],s={};for(u in m)m.hasOwnProperty(u)&&(h=m[u](r,t(r,e(u))),s[u]=null===h?i(kt.options()[u]):h);l.push(kt.create(r,s))}return l},kt.find=function(t){var e=r.filter(function(e){return e.isAttachedTo(t)});return e?e[0]:null},kt.create=function(t,e){if(!kt.find(t)){var i=new kt(t,e);return r.push(i),i}},kt.destroy=function(t){var e=a(t);return 0>e?!1:(r[e].destroy(),r[e]=null,r.splice(e,1),!0)}}(),kt}(),"loading"!==document.readyState?i():document.addEventListener("DOMContentLoaded",i))}(this);